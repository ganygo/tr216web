
<%

  if(typeof mode=='undefined') mode=func;
  if(typeof action=='undefined') action='';
  if(typeof caption=='undefined') caption='';
  if(typeof formName=='undefined') formName='form-general';
  if(typeof message=='undefined') message='';

  if(typeof tabs=='undefined') showTabs=false;
  
  /*pageHeaderButtons={visible:true, save:false, back:true}
  if(mode!='view'){
    pageHeaderButtons.save=true;
  }
  if(typeof backUrl!='undefined'){
      pageHeaderButtons['backUrl']=backUrl;
  } 
  */

%>
<form action="<%=action%>" method="POST" role="form" name="<%=formName%>" id="<%=formName%>">
  <div class="row page-header">
    <div class="col-md-8">
    </div>
    <div class="col-md-4 text-right">
      <button type="submit" form="<%=formName%>" class="btn btn-primary" title="Kaydet"><i class="fas fa-save"></i></button>
      <a href="javascript:openBack()" class="btn btn-dark" title="VazgeÃ§"><i class="fas fa-reply"></i></a>
    </div>
  </div>
  <% if(message!=''){ %>
  <div class="row">
    <div class="col-lg-12 col-md-12">
          <div class="alert alert-danger" role="alert">
            <%=message %>
          </div>
    </div>
  </div>
  <% } %>
  <% if(caption!=''){ %>
   <div class="row">
    <div class="col-lg-12 col-md-12">
          <center><h3><%=caption%></h3></center>
    </div>
  </div>
  <% } %>
    <% if(typeof tabs!='undefined'){ %>
    <%
      var bFound=false;
      for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){
        if(typeof tabs[tabIndex].active=='undefined') tabs[tabIndex].active=false;
        if(tabs[tabIndex].active) bFound=true;
      }
      if(bFound==false && tabs.length>0) tabs[0].active=true;
    %>
    <ul class="nav nav-tabs" role="tablist">
      <% for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){ %>
      <li class="nav-item">
          <a class="nav-link<%- tabs[tabIndex].active?' active':'' %>" href="#tab<%=tabIndex%>" role="tab" data-toggle="tab" id="IDtab<%=tabIndex%>" aria-controls="tab<%=tabIndex%>" aria-selected="<%- tabs[tabIndex].active?'true':'false' %>">
              <% if(typeof tabs[tabIndex].icon!='undefined'){%><i class="fa fa-<%=tabs[tabIndex].icon %>"></i><%}%> <%=tabs[tabIndex].caption %>
          </a>
      </li>
      <% } %>
    </ul>
    <div class="tab-content" style="min-height: 70vh;">
      <% for(var tabIndex=0;tabIndex<tabs.length;tabIndex++){ %>
        <div class="tab-pane fade<%- tabs[tabIndex].active?' show active':''%> " id="tab<%=tabIndex%>" role="tabpanel" aria-labelledby="IDtab<%=tabIndex%>">
          <% if(typeof tabs[tabIndex].partial!='undefined'){ %>
          <%- partial(tabs[tabIndex].partial,form) %>
          <% } %>

          <% if(typeof tabs[tabIndex].formControls!='undefined'){ %>
          <%- standartForm(tabs[tabIndex]) %>
          <% } %>

       </div>
       <% } %>
    </div>
 <% } else { %>
    <%- standartForm(this) %>
 <% } %>
  
</form>

<script type="text/javascript">
  function openBack(){
    if(localStorage.getItem('returnUrl')){
      var returnUrl=localStorage.getItem('returnUrl');
      console.log('returnUrl back:',returnUrl);
      localStorage.removeItem('returnUrl');

      if(returnUrl.indexOf('db=<%=db%>')>0 && returnUrl.indexOf('sid=<%=sid%>')>0){
        window.location.href=returnUrl;
      }else{
        history.back(1);
      }
    }else{
      history.back(1);
    }
  }
</script>

<% function standartForm(formObject){ %>
  <div class="row">
      <div class="col-lg-12 col-md-12">
            <% 
              var partialData={};
              partialData.formControls=formObject.formControls;
              partialData.mode=formObject.mode;
              
            %>
            <%- partial('form-partial', partialData) %>
      </div>
  </div>
<% } %>

